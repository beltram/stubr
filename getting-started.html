<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting started - stubr</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="getting-started.html" class="active"><strong aria-hidden="true">2.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="stubbing.html"><strong aria-hidden="true">3.</strong> Stubbing</a></li><li class="chapter-item expanded "><a href="contract/index.html"><strong aria-hidden="true">4.</strong> Contract Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contract/producer.html"><strong aria-hidden="true">4.1.</strong> As a producer</a></li><li class="chapter-item expanded "><a href="contract/consumer.html"><strong aria-hidden="true">4.2.</strong> As a consumer</a></li></ol></li><li class="chapter-item expanded "><a href="stubs/index.html"><strong aria-hidden="true">5.</strong> Writing Stubs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="stubs/request.html"><strong aria-hidden="true">5.1.</strong> Request</a></li><li class="chapter-item expanded "><a href="stubs/response.html"><strong aria-hidden="true">5.2.</strong> Response</a></li><li class="chapter-item expanded "><a href="stubs/relaxing.html"><strong aria-hidden="true">5.3.</strong> Relaxing</a></li></ol></li><li class="chapter-item expanded "><a href="recording/index.html"><strong aria-hidden="true">6.</strong> Recording</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="recording/actix.html"><strong aria-hidden="true">6.1.</strong> Actix</a></li><li class="chapter-item expanded "><a href="recording/cli.html"><strong aria-hidden="true">6.2.</strong> Cli</a></li><li class="chapter-item expanded "><a href="recording/isahc.html"><strong aria-hidden="true">6.3.</strong> isahc</a></li><li class="chapter-item expanded "><a href="recording/reqwest.html"><strong aria-hidden="true">6.4.</strong> reqwest</a></li><li class="chapter-item expanded "><a href="recording/standalone.html"><strong aria-hidden="true">6.5.</strong> standalone</a></li></ol></li><li class="chapter-item expanded "><a href="cli.html"><strong aria-hidden="true">7.</strong> Cli</a></li><li class="chapter-item expanded "><a href="docker.html"><strong aria-hidden="true">8.</strong> Docker</a></li><li class="chapter-item expanded "><a href="ide-completion.html"><strong aria-hidden="true">9.</strong> IDE completion</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">stubr</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h1>
<p>For this short demo we are going to create a http stub, mount it in a stub server and then call it to verify it works.</p>
<h2 id="installation"><a class="header" href="#installation">installation</a></h2>
<h4 id="recommended"><a class="header" href="#recommended">recommended</a></h4>
<p><em>If you don't have it, install rustup from <a href="https://rustup.rs/">here</a>.</em></p>
<pre><code class="language-bash">cargo install stubr-cli
</code></pre>
<h4 id="or-from-precompiled-binaries"><a class="header" href="#or-from-precompiled-binaries">or from precompiled binaries</a></h4>
<p>Those binaries are stripped with <a href="https://upx.github.io/">upx</a> and then compressed. They are likely to be smaller than
the ones built by rustc which might be preferable in certain conditions</p>
<h6 id="macos"><a class="header" href="#macos">macos</a></h6>
<pre><code class="language-bash">curl -L https://github.com/beltram/stubr/releases/latest/download/stubr-macos.tar.gz | tar xz - -C /usr/local/bin
</code></pre>
<h6 id="linux"><a class="header" href="#linux">linux</a></h6>
<pre><code class="language-bash">curl -L https://github.com/beltram/stubr/releases/latest/download/stubr-linux.tar.gz | tar xz - -C /usr/local/bin
</code></pre>
<h6 id="windows"><a class="header" href="#windows">windows</a></h6>
<p>Install binary from <a href="https://github.com/beltram/stubr/releases/latest/download/stubr-windozs.zip">here</a>.</p>
<h2 id="hello-world-"><a class="header" href="#hello-world-">Hello world !</a></h2>
<p>We are going to create the simplest stub possible. It will accept any http method on any path and will respond <code>200 OK</code>.</p>
<pre><code class="language-bash">cat &gt; stub.json &lt;&lt;- EOF
{
  &quot;request&quot;: {
    &quot;method&quot;: &quot;ANY&quot;
  },
  &quot;response&quot;: {
    &quot;status&quot;: 200,
    &quot;body&quot;: &quot;Hello world !&quot;,
  }
}
EOF
</code></pre>
<p>A few things about a stub:</p>
<ul>
<li>It is a json file. First because it is the format supported by <a href="https://github.com/tomakehurst/wiremock">Wiremock</a> and
we want to be compatible with it. Also, most of the time, your http APIs will consume/produce json data in their
bodies. So you can inline the request/response body in this file without externalizing it.</li>
<li><code>request { .. }</code> is where we define <strong>request matching</strong> i.e. &quot;<em>conditions the incoming http request has to satisfy in
order for the response part to be served</em>&quot;</li>
<li><code>response { .. }</code> is the part where you define what the stub server will respond if all request matchings pass.</li>
</ul>
<h4 id="mount-it"><a class="header" href="#mount-it">mount it</a></h4>
<p>The cli can spawn a http server with a path to the file or folder containing json stubs. By default, it will try to bind
to a random port, here we force it to attach to port <code>8080</code>.</p>
<pre><code class="language-bash">stubr stub.json -p 8080 &amp;
</code></pre>
<h4 id="call-it"><a class="header" href="#call-it">call it</a></h4>
<p>Now let's verify our stub server is up and running and that it serves our stubs the right way.</p>
<pre><code class="language-bash">curl -i http://localhost:8080
</code></pre>
<p>Which should output:</p>
<pre><code class="language-bash">HTTP/1.1 200 OK
server: stubr(0.4.14)
content-length: 0
date: Fri, 22 Jul 2022 19:31:48 GMT

Hello world !%
</code></pre>
<p>or with httpie</p>
<pre><code class="language-bash">http :8080
</code></pre>
<h2 id="hello-name-"><a class="header" href="#hello-name-">Hello {name} !</a></h2>
<p>Now let's spice things a bit and make our stub a bit more dynamic by capturing a part of the request path and template
it in the response (this is called <a href="stubs/response-templating.html">response templating</a>).</p>
<p>But first let's kill the previous server</p>
<pre><code class="language-bash">lsof -ti tcp:8080 | xargs kill
</code></pre>
<pre><code class="language-bash">cat &gt; hello.json &lt;&lt;- EOF
{
  &quot;request&quot;: {
    &quot;method&quot;: &quot;GET&quot;,
    &quot;urlPathPattern&quot;: &quot;/hello/(.+)&quot;
  },
  &quot;response&quot;: {
    &quot;status&quot;: 200,
    &quot;body&quot;: &quot;Hello {{request.pathSegments.[1]}} !&quot;,
    &quot;transformers&quot;: [&quot;response-template&quot;]
  }
}
EOF
</code></pre>
<p>Here:</p>
<ul>
<li><code>&quot;urlPathPattern&quot;: &quot;/hello/(.+)&quot;</code> is one way to express URL matching. It contains a regular hardcoded path <code>/hello/</code>
and a regular expression <code>(.+)</code> which has to match in order for the stub response to be served.</li>
<li><code>&quot;transformers&quot;: [&quot;response-template&quot;]</code> will activate response templating. This allows you to inject a part of the
request in the response. Prefer using it over hardcoded values when your real life application actually does that. The
more you use it the better your test accuracy will be.</li>
<li><code>{{request.pathSegments.[1]}}</code> now that response templating is enabled, you can inject parts of your request in the
response. With <a href="https://github.com/tomakehurst/wiremock">Wiremock</a> as with stubr, we
use <a href="https://handlebarsjs.com/">handlebars</a> templates to do such a
thing. <a href="stubs/response-templating.html">Many response templates are available</a> in stubr in order to pick whatever part
of the request you want.</li>
</ul>
<h4 id="mount-it-1"><a class="header" href="#mount-it-1">Mount it</a></h4>
<pre><code class="language-bash">stubr hello.json -p 8080 &amp;
</code></pre>
<h4 id="call-it-1"><a class="header" href="#call-it-1">call it</a></h4>
<pre><code class="language-bash">curl -i http://localhost:8080/hello/stubr
</code></pre>
<p>Which should output:</p>
<pre><code class="language-bash">HTTP/1.1 200 OK
server: stubr(0.4.14)
content-type: text/plain
content-length: 13
date: Sat, 23 Jul 2022 09:25:42 GMT

Hello stubr !%
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="stubbing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="stubbing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
