<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Request - stubr</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started/unit-test.html"><strong aria-hidden="true">2.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/unit-test.html"><strong aria-hidden="true">2.1.</strong> unit test</a></li><li class="chapter-item expanded "><a href="../getting-started/standalone.html"><strong aria-hidden="true">2.2.</strong> standalone</a></li></ol></li><li class="chapter-item expanded "><a href="../contract/index.html"><strong aria-hidden="true">3.</strong> Contract Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contract/producer.html"><strong aria-hidden="true">3.1.</strong> As a producer</a></li><li class="chapter-item expanded "><a href="../contract/consumer.html"><strong aria-hidden="true">3.2.</strong> As a consumer</a></li><li class="chapter-item expanded "><a href="../contract/relaxing.html"><strong aria-hidden="true">3.3.</strong> Relaxing</a></li></ol></li><li class="chapter-item expanded "><a href="../stubs/index.html"><strong aria-hidden="true">4.</strong> Writing Stubs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../stubs/request.html" class="active"><strong aria-hidden="true">4.1.</strong> Request</a></li><li class="chapter-item expanded "><a href="../stubs/response.html"><strong aria-hidden="true">4.2.</strong> Response</a></li></ol></li><li class="chapter-item expanded "><a href="../recording/index.html"><strong aria-hidden="true">5.</strong> Recording</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../recording/actix.html"><strong aria-hidden="true">5.1.</strong> Actix</a></li><li class="chapter-item expanded "><a href="../recording/cli.html"><strong aria-hidden="true">5.2.</strong> Cli</a></li><li class="chapter-item expanded "><a href="../recording/isahc.html"><strong aria-hidden="true">5.3.</strong> isahc</a></li><li class="chapter-item expanded "><a href="../recording/reqwest.html"><strong aria-hidden="true">5.4.</strong> reqwest</a></li><li class="chapter-item expanded "><a href="../recording/standalone.html"><strong aria-hidden="true">5.5.</strong> standalone</a></li></ol></li><li class="chapter-item expanded "><a href="../cli.html"><strong aria-hidden="true">6.</strong> Cli</a></li><li class="chapter-item expanded "><a href="../docker.html"><strong aria-hidden="true">7.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../benchmark.html"><strong aria-hidden="true">8.</strong> Benchmark</a></li><li class="chapter-item expanded "><a href="../ide-completion.html"><strong aria-hidden="true">9.</strong> IDE completion</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">stubr</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="request"><a class="header" href="#request">Request</a></h1>
<p>With request matching you have to describe all the conditions the incoming http requests have to match in order for your
stub response to be served. Most of the time, you will opt in for a conservative approach where you will have exhaustive
and strict conditions. That's when you want to assess the http caller behaves the right way. Other times you do not care
about request matching at all e.g. you use <a href="https://github.com/beltram/stubr">stubr</a> to benchmark a reverse proxy: in that
case <code>request { &quot;method&quot;: &quot;ANY&quot; }</code> is enough. <strong>Just write the request matching you need</strong>.</p>
<h2 id="method"><a class="header" href="#method">Method</a></h2>
<p>Expects the request method. Use <code>ANY</code> when you do not care which method it will be.<br />
Available verbs are <code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>CONNECT</code>, <code>OPTIONS</code>, <code>TRACE</code>, <code>PATCH</code></p>
<p><em>Note: <code>method</code> is optional and defaults to <code>ANY</code></em></p>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;method&quot;: &quot;GET&quot;
  }
}
</code></pre>
<h2 id="uri"><a class="header" href="#uri">URI</a></h2>
<p>To match request's URI (and maybe its query parameters). Only one of the following matcher is allowed. If more than one
are present, it does not fail but chooses one matcher according to the descending
priority <code>url</code> &gt; <code>urlPath</code> &gt; <code>urlPattern</code> &gt; <code>urlPathPattern</code></p>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;url&quot;: &quot;/api/uri?age=young&quot;,
    &quot;urlPath&quot;: &quot;/api/exact-uri&quot;,
    &quot;urlPattern&quot;: &quot;/api/regex-uri/([a-z]{4})\\?and=([a-z]{4})&quot;,
    &quot;urlPathPattern&quot;: &quot;/api/regex-uri/([a-z]{4})&quot;
  }
}
</code></pre>
<ul>
<li><code>url</code>: Matches by equality the URI and query parameters.</li>
<li><code>urlPath</code>: Matches by equality <strong>just</strong> the URI without query parameters.</li>
<li><code>urlPattern</code>: Matches URI and query parameters. Path segments and query parameters value can contain regexes.</li>
<li><code>urlPathPattern</code>: Matches <strong>just</strong> the URI without query parameters. Path segments can contain regexes.</li>
</ul>
<h2 id="query-parameters"><a class="header" href="#query-parameters">Query parameters</a></h2>
<p>Allows matching query parameters. Prefer this instead of <a href="#uri">URI</a> matching just because it is clearer. Multivalued
query parameters are not supported yet.</p>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;queryParameters&quot;: {
      &quot;firstname&quot;: { &quot;equalTo&quot;: &quot;beltram&quot; },
      &quot;lastname&quot;: { &quot;equalTo&quot;: &quot;maldant&quot;, &quot;caseInsensitive&quot;: true },
      &quot;age&quot;: { &quot;absent&quot;: true },
      &quot;birthdate&quot;: { &quot;absent&quot;: false },
      &quot;city&quot;: { &quot;contains&quot;: &quot;at&quot; },
      &quot;title&quot;: { &quot;matches&quot;: &quot;([A-Za-z]+)&quot; },
      &quot;job&quot;: { &quot;doesNotMatch&quot;: &quot;([A-Za-z]+)&quot; }
    }
  }
}
</code></pre>
<ul>
<li><code>equalTo</code> by equality matcher. Can be a string, a boolean, a number, null etc... Can be turned case-insensitive
with <code>caseInsensitive</code>.</li>
<li><code>absent</code> specified query parameter key must be absent/present.</li>
<li><code>contains</code> value must contain the supplied string in a case-insensitive way</li>
<li><code>matches</code>/<code>doesNotMatch</code> value must match the supplied regex (or not)</li>
</ul>
<h2 id="headers"><a class="header" href="#headers">Headers</a></h2>
<p>Header matcher are <strong>exactly</strong> the same as <a href="#query-parameters">query parameter matcher</a> above.</p>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;headers&quot;: {
      &quot;content-type&quot;: { &quot;equalTo&quot;: &quot;application/json&quot; }
    }
  }
}
</code></pre>
<h2 id="authorization"><a class="header" href="#authorization">Authorization</a></h2>
<p>Those matcher are exclusive to stubr and not available in Wiremock. They allow crafting more relaxed request matchers
when it comes to authorization. You could for example have stubs specialized for a specific user (we sometimes persona).</p>
<p>You can have matchers for Basic authentication (<a href="https://datatracker.ietf.org/doc/html/rfc7617">RFC 7617</a>). For example,
for matching <code>Authorization: Basic am9obi5kb2U6Y2hhbmdlbWU=</code> you would have:</p>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;basicAuth&quot;: {
      &quot;username&quot;: &quot;john.doe&quot;,
      &quot;password&quot;: &quot;changeme&quot;
    }
  }
}
</code></pre>
<p>You can also match a JWT token in the <code>Authorization</code> header as
per <a href="https://datatracker.ietf.org/doc/html/rfc7519">RFC 7519</a></p>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;jwtAuth&quot;: {
      &quot;equalTo&quot;: &quot;eyJhbGciOiJSUzI1NiJ9.e30.MBkQ...&quot;,
      &quot;alg&quot;: {
        &quot;equalTo&quot;: &quot;RS256&quot;,
        &quot;oneOf&quot;: [ &quot;RS256&quot;, &quot;HS256&quot; ]
      },
      &quot;payloadPatterns&quot;: [
        { &quot;equalToJson&quot;: { &quot;iss&quot;: &quot;john.doe&quot; } },
        { &quot;equalToJson&quot;: { &quot;exp&quot;: 1300819380 } },
        {
          &quot;expression&quot;: &quot;$.address&quot;,
          &quot;equalToJson&quot;: { &quot;street&quot;: &quot;rue de Rivoli&quot;, &quot;city&quot;: &quot;Paris&quot; }
        }
      ]
    }
  }
}
</code></pre>
<ul>
<li><code>equalTo</code> by equality matcher. Equivalent to <code>&quot;headers&quot;:{&quot;authorization&quot;:{&quot;equalTo&quot;: &quot;...&quot;}}</code>. If you have this
matcher, all the other ones will be ignored</li>
<li><code>alg.equalTo</code> by equality matcher. JWT algorithm has to be exactly this</li>
<li><code>alg.oneOf</code> JWT algorithm has to be one of the supplied values. Here are all the supported JWT
algorithms: <code>HS256</code>, <code>HS384</code>, <code>HS512</code>, <code>ES256</code>, <code>ES384</code>, <code>RS256</code>, <code>RS384</code>, <code>RS512</code>, <code>PS256</code>, <code>PS384</code>, <code>PS512</code>, <code>EdDSA</code></li>
<li><code>payloadPatterns</code> for matching the JWT body. Exactly the same matcher as <a href="#body">body</a> ones.</li>
</ul>
<h2 id="body"><a class="header" href="#body">Body</a></h2>
<pre><code class="language-json">{
  &quot;request&quot;: {
    &quot;bodyPatterns&quot;: [
      { &quot;equalToJson&quot;: { &quot;name&quot;: &quot;bob&quot; } },
      {
        &quot;equalToJson&quot;: {&quot;names&quot;: [&quot;alice&quot;, &quot;bob&quot;]},
        &quot;ignoreExtraElements&quot;: true,
        &quot;ignoreArrayOrder&quot;: true
      },
      { &quot;matchesJsonPath&quot;: &quot;$.name&quot; },
      { &quot;matchesJsonPath&quot;: &quot;$.consoles[?(@.name == 'xbox')]&quot; },
      { &quot;matchesJsonPath&quot;: &quot;$.consoles[?(@.price &gt; 200)]&quot; },
      { &quot;expression&quot;: &quot;$.name&quot;, &quot;contains&quot;: &quot;at&quot; },
      { &quot;expression&quot;: &quot;$.user&quot;, &quot;equalToJson&quot;: { &quot;name&quot;: &quot;bob&quot; } },
      { &quot;expression&quot;: &quot;$.age&quot;, &quot;equalToJson&quot;: 42 },
      { &quot;binaryEqualTo&quot;: &quot;AQID&quot; }
    ]
  }
}
</code></pre>
<ul>
<li><code>equalToJson</code> strict equality matcher. Request body has to be exactly equal to this. If it is not used
with <code>expression</code>, all other matchers will be ignored. However, it can be relaxed with:
<ul>
<li><code>ignoreExtraElements</code> to ignore json fields in the http request not present in the matcher</li>
<li><code>ignoreArrayOrder</code> to match json arrays regardless the order of their items</li>
</ul>
</li>
<li><code>expression</code> a <a href="https://www.ietf.org/archive/id/draft-goessner-dispatch-jsonpath-00.html">JSONPath</a> matcher used to
narrow the matching. The matched expression has then to be verified by either:
<ul>
<li><code>equalToJson</code> for strict equality (can be another json object, a string, number etc..)</li>
<li><code>contains</code> ; if json matched by <code>expression</code> is a string it must contain the supplied string</li>
</ul>
</li>
<li><code>matchesJsonPath</code> json request body has to contain the supplied key identified by
a <a href="https://www.ietf.org/archive/id/draft-goessner-dispatch-jsonpath-00.html">JSONPath</a>. You can also
use <a href="https://docs.hevodata.com/sources/streaming/rest-api/writing-jsonpath-expressions/">JSONPath expression</a> to also
filter and match the json values</li>
<li><code>binaryEqualTo</code> byte equality matcher. Has to be base 64 encoded</li>
</ul>
<h2 id="priority"><a class="header" href="#priority">Priority</a></h2>
<p>Sometimes, you can have 2 different stubs that could both match a given http request. This happens most of the time when
you start writing stubs for your application errors. You basically should have:</p>
<ul>
<li>one relaxed stub for your nominal case matching for example <code>&quot;urlPathPattern&quot;: &quot;/users/([0-9]{4})&quot;</code></li>
<li>one stub for each error with hardcoded value e.g. <code>&quot;urlPath&quot;: &quot;/users/1234&quot;</code> for a <code>404</code> response</li>
</ul>
<p>The issue here is that if your stub server receives a <code>GET /users/1234</code> request, both stubs will match. You want your
error stub to have a higher than the nominal e.g. error stub will have a priority of 1 whereas the nominal one will have
a priority of 2.</p>
<pre><code class="language-json">{
  &quot;priority&quot;: 1
}
</code></pre>
<ul>
<li><code>priority</code> a u8. 1 is the highest priority, 255 the lowest, 5 the default value when absent. It is optional.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../stubs/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../stubs/response.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../stubs/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../stubs/response.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>


    </body>
</html>
